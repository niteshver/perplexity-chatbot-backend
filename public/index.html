<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Enhanced Navi AI Chat</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

  body {
    margin: 0;
    background: #f9fafb;
    font-family: 'Inter', sans-serif;
    color: #333;
    display: flex;
    justify-content: center;
    padding: 40px 0;
    min-height: 100vh;
    box-sizing: border-box;
  }

  #app {
    width: 600px;
    background: #fff;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.05);
    border-radius: 20px;
    display: flex;
    flex-direction: column;
    overflow: hidden;
  }

  nav {
    padding: 20px 30px;
    font-weight: 700;
    font-size: 24px;
    letter-spacing: 1px;
    border-bottom: 1px solid #ddd;
    text-align: center;
    color: #555;
  }

  nav span {
    color: #df7c5b;
  }

  #chat-container {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    height: 750px;
  }

  #messages {
    flex-grow: 1;
    overflow-y: auto;
    padding: 30px 40px 0 40px;
    background: #fafafa;
    border-top: 1px solid #ddd;
  }

  .message {
    max-width: 80%;
    margin-bottom: 28px;
    padding: 20px 28px;
    border-radius: 28px;
    font-size: 17px;
    line-height: 1.5;
    box-shadow: 0 2px 20px rgba(223, 124, 91, 0.08);
    opacity: 0;
    animation: fadeIn 0.5s forwards;
    word-wrap: break-word;
    position: relative;
  }

  .message.bot {
    background: #f0e4da;
    color: #555;
    align-self: flex-start;
    border-bottom-left-radius: 10px;
  }

  .message.user {
    background: #df7c5b;
    color: #fff;
    align-self: flex-end;
    border-bottom-right-radius: 10px;
  }

  .message img {
    max-width: 100%;
    border-radius: 12px;
    margin-top: 10px;
  }

  #input-area {
    display: flex;
    border-top: 1px solid #ddd;
    background: white;
    padding: 20px 30px;
  }

  #input {
    flex-grow: 1;
    padding: 20px 30px;
    font-size: 16px;
    border-radius: 40px 0 0 40px;
    border: 1px solid #ddd;
    outline: none;
    transition: border-color 0.3s ease;
  }

  #input:focus {
    border-color: #df7c5b;
  }

  #send-btn {
    background: #df7c5b;
    border: none;
    padding: 0 40px;
    font-size: 18px;
    font-weight: 700;
    border-radius: 0 40px 40px 0;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(223, 124, 91, 0.3);
    transition: background 0.3s ease;
  }

  #send-btn:hover {
    background: #c96f40;
  }

  #voice-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 22px;
    margin-left: 15px;
    color: #df7c5b;
    outline: none;
  }

  @keyframes fadeIn {
    to {
      opacity: 1;
    }
  }

  #footer-credit {
    position: fixed;
    bottom: 15px;
    right: 20px;
    color: #999;
    font-size: 14px;
    font-weight: 500;
    font-family: 'Inter', sans-serif;
    user-select: none;
  }

  #messages::-webkit-scrollbar {
    width: 8px;
  }
  #messages::-webkit-scrollbar-thumb {
    background-color: #df7c5b;
    border-radius: 20px;
  }
</style>
</head>
<body>
  <div id="app">
    <nav>Navi <span>AI</span></nav>
    <div id="chat-container">
      <div id="messages" aria-live="polite" aria-label="Chat messages"></div>
      <div id="input-area">
        <input id="input" type="text" placeholder="Type your messageâ€¦" aria-label="Chat message input" autocomplete="off" />
        <button id="send-btn" aria-label="Send message">Send</button>
        <button id="voice-btn" title="Start voice input" aria-label="Voice input">ðŸŽ¤</button>
      </div>
    </div>
  </div>

  <div id="footer-credit">Created by <strong>Nitesh</strong></div>

  <script>
    const input = document.getElementById('input');
    const sendBtn = document.getElementById('send-btn');
    const voiceBtn = document.getElementById('voice-btn');
    const messagesDiv = document.getElementById('messages');

    let chatHistory = [];

    function addMessage(text, className, isImage = false) {
      if (isImage) {
        const img = document.createElement('img');
        img.src = text;
        img.alt = "Generated Image";
        img.className = className;
        messagesDiv.appendChild(img);
      } else {
        const msg = document.createElement('div');
        msg.className = 'message ' + className;
        msg.textContent = text;
        messagesDiv.appendChild(msg);
      }
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    async function sendMessage(message) {
      const msg = message || input.value.trim();
      if (!msg) return;

      addMessage(msg, 'user');
      chatHistory.push({ role: 'user', content: msg });
      if (!message) input.value = '';

      try {
        const res = await fetch('/api/chat', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ message: msg, history: chatHistory, type: msg.toLowerCase().startsWith('generate image') ? 'image' : 'text' })
        });

        if (!res.ok) {
          addMessage('Error: Unable to get response', 'bot');
          return;
        }

        const data = await res.json();
        if (data.type === 'image' && data.imageUrl) {
          addMessage(data.imageUrl, 'bot', true);
          chatHistory.push({ role: 'assistant', content: data.imageUrl, isImage: true });
          speakText('Image generated for your prompt');
        } else {
          addMessage(data.response, 'bot');
          chatHistory.push({ role: 'assistant', content: data.response });
          speakText(data.response);
        }
      } catch (e) {
        addMessage('Error: Network problem', 'bot');
      }
    }

    sendBtn.addEventListener('click', () => sendMessage());
    input.addEventListener('keydown', e => {
      if (e.key === 'Enter') {
        sendMessage();
      }
    });

    // Voice input implementation
    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    const recognition = SpeechRecognition ? new SpeechRecognition() : null;

    if (recognition) {
      recognition.continuous = false;
      recognition.interimResults = false;
      recognition.lang = 'en-US';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript;
        sendMessage(transcript);
      };

      recognition.onerror = (event) => {
        console.error('Speech recognition error', event.error);
      };

      voiceBtn.addEventListener('click', () => {
        voiceBtn.disabled = true;
        recognition.start();
      });

      recognition.onend = () => {
        voiceBtn.disabled = false;
      };
    } else {
      voiceBtn.style.display = 'none'; // hide if not supported
    }

    // Text-to-Speech for bot messages
    function speakText(text) {
      if (!window.speechSynthesis) return;

      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = 'en-US';
      utterance.rate = 1;
      speechSynthesis.speak(utterance);
    }
  </script>
</body>
</html>
